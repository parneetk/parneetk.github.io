<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Convolutional Neural Networks (CNN) for MNIST Dataset • Parneet Kaur</title>
    <meta name="description" content="Examples to implement CNN in Keras">
    	
		<!-- Twitter Cards -->
		<meta name="twitter:title" content="Convolutional Neural Networks (CNN) for MNIST Dataset">
		<meta name="twitter:description" content="Examples to implement CNN in Keras">
		<meta name="twitter:site" content="@_parneetkaur">
		<meta name="twitter:creator" content="@_parneetkaur">
		
		<meta name="twitter:card" content="summary">
		<meta name="twitter:image" content="http://parneetk.github.io/images/site-logo.png# 120x120 px default image used for Twitter summary card">
		
	
		<!-- Open Graph -->
		<meta property="og:locale" content="en_US">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Convolutional Neural Networks (CNN) for MNIST Dataset">
		<meta property="og:description" content="Examples to implement CNN in Keras">
		<meta property="og:url" content="http://parneetk.github.io/blog/cnn-mnist/">
		<meta property="og:site_name" content="Parneet Kaur">
    <link rel="canonical" href="http://parneetk.github.io/blog/cnn-mnist/">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="http://parneetk.github.io/sitemap.xml">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <!-- Webmaster Tools verifications -->
    
    
    
    

    

    <link rel="stylesheet" href="/assets/global-3c4fd48ce335e959c9281b521601047b.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="/assets/vendor/html5shiv-885c726bf070ed12d4f7169c3cef6cac.js"></script>
      <script src="/assets/vendor/respond-436602cb1583ac6782a71c2d567a5b2c.js"></script>
    <![endif]-->

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-danger"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->
    <header id="masthead">
  <div class="masthead-contents">
    <div class="logo-wrap">
      <a href="/" class="site-title">Parneet Kaur</a>
    </div>
    <nav role="navigation" class="menu top-menu">
      <ul class="menu-item">
	
    <li><a href="/">Home</a></li>
  
    <li><a href="/research/">Research</a></li>
  
    <li><a href="/projects/">Projects</a></li>
  
    <li><a href="/blog/">Blog</a></li>
  
    <li><a href="/contact-me/">Contact Me</a></li>
  
</ul>
    </nav>
  </div><!-- /.masthead-contents -->
</header><!-- /.masthead -->
    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>Parneet Kaur <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="/">
        
        <div class="title">Home</div>
        
      </a>
    </li><li>
      <a href="/research/">
        
        <div class="title">Research</div>
        
      </a>
    </li><li>
      <a href="/projects/">
        
        <div class="title">Projects</div>
        
      </a>
    </li><li>
      <a href="/blog/">
        
        <div class="title">Blog</div>
        
      </a>
    </li><li>
      <a href="/contact-me/">
        
        <div class="title">Contact Me</div>
        
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>

    <div id="page-wrapper">
      <div id="main" role="main">         
  <article class="wrap" itemscope itemtype="http://schema.org/Article">
    <div class="page-header">
      
      <div class="page-title">
        
  <nav class="breadcrumbs">
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="http://parneetk.github.io" itemprop="url"><span itemprop="title">Home</span></a> › 
    </span>
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="http://parneetk.github.io/blog/" itemprop="url">
        <span itemprop="title">
          
          
            Blog
              
          
        </span>
      </a> › 
    </span>
  </nav><!-- /.breadcrumbs -->




        <h1><span>Convolutional Neural Networks (CNN) for MNIST Dataset</span></h1>
      </div><!-- /.page-title -->
    </div><!-- /.page-header -->
    <div class="inner-wrap">
      <div id="content" class="page-content" itemprop="articleBody">
        <p>iPython Notebook for this tutorial is available <a href="https://github.com/parneetk/Neural-Networks-in-Keras">here</a>.<br /></p>

<p>The examples in this notebook assume that you are familiar with the theory of the neural networks. To learn more about the neural networks, you can refer resources <a href="https://github.com/parneetk/Neural-Networks-in-Keras/blob/master/README.md">here</a>.</p>

<h2 id="import-necessary-modules">Import necessary modules</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2017</span><span class="p">)</span></code></pre></div>

<h2 id="import-mnist-dataset">Import MNIST Dataset</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">keras.datasets</span> <span class="kn">import</span> <span class="n">mnist</span>
<span class="p">(</span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">_</span><span class="p">,</span> <span class="n">img_rows</span><span class="p">,</span> <span class="n">img_cols</span> <span class="o">=</span>  <span class="n">train_features</span><span class="o">.</span><span class="n">shape</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
<span class="n">num_input_nodes</span> <span class="o">=</span> <span class="n">img_rows</span><span class="o">*</span><span class="n">img_cols</span></code></pre></div>

<pre><code>Using Theano backend.
</code></pre>

<h2 id="data-pre-processing">Data Pre-processing</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">np_utils</span>
<span class="n">train_features</span> <span class="o">=</span> <span class="n">train_features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">train_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">img_rows</span><span class="p">,</span> <span class="n">img_cols</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">test_features</span> <span class="o">=</span> <span class="n">test_features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">test_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">img_rows</span><span class="p">,</span> <span class="n">img_cols</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">train_features</span> <span class="o">/=</span> <span class="mi">255</span>
<span class="n">test_features</span> <span class="o">/=</span> <span class="mi">255</span>
<span class="c"># convert class labels to binary class labels</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">np_utils</span><span class="o">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">train_labels</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">test_labels</span> <span class="o">=</span> <span class="n">np_utils</span><span class="o">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span></code></pre></div>

<h2 id="function-to-plot-model-accuracy-and-loss">Function to plot model accuracy and loss</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">plot_model_history</span><span class="p">(</span><span class="n">model_history</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="c"># summarize history for accuracy</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;acc&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;acc&#39;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;val_acc&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;val_acc&#39;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Model Accuracy&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Accuracy&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;acc&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;acc&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;train&#39;</span><span class="p">,</span> <span class="s">&#39;val&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">)</span>
    <span class="c"># summarize history for loss</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;loss&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;loss&#39;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;val_loss&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;val_loss&#39;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Model Loss&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Loss&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;loss&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">model_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">&#39;loss&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;train&#39;</span><span class="p">,</span> <span class="s">&#39;val&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

<h2 id="funtion-to-compute-test-accuracy">Funtion to compute test accuracy</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
    <span class="n">predicted_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">true_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">num_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">predicted_class</span> <span class="o">==</span> <span class="n">true_class</span><span class="p">)</span> 
    <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">num_correct</span><span class="p">)</span><span class="o">/</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">accuracy</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span></code></pre></div>

<h2 id="import-necessary-modules-1">Import necessary modules</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers.convolutional</span> <span class="kn">import</span> <span class="n">Convolution2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Activation</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">keras.optimizers</span> <span class="kn">import</span> <span class="n">SGD</span>
<span class="kn">from</span> <span class="nn">keras.layers.normalization</span> <span class="kn">import</span> <span class="n">BatchNormalization</span></code></pre></div>

<h2 id="a-simple-cnn">A Simple CNN</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define the model</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Convolution2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">border_mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)))</span> 
<span class="n">model1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">))</span>
<span class="n">model1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;softmax&quot;</span><span class="p">))</span>
<span class="c"># Compile the model</span>
<span class="n">model1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="c"># Train the model</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">model1_info</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c"># plot model history</span>
<span class="n">plot_model_history</span><span class="p">(</span><span class="n">model1_info</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Model took </span><span class="si">%0.2f</span><span class="s"> seconds to train&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
<span class="c"># compute test accuracy</span>
<span class="k">print</span> <span class="s">&quot;Accuracy on test data is: </span><span class="si">%0.2f</span><span class="s">&quot;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">(</span><span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">model1</span><span class="p">)</span></code></pre></div>

<pre><code>Train on 48000 samples, validate on 12000 samples
Epoch 1/20
31s - loss: 0.3425 - acc: 0.9042 - val_loss: 0.1285 - val_acc: 0.9665
Epoch 2/20
31s - loss: 0.1029 - acc: 0.9712 - val_loss: 0.0794 - val_acc: 0.9780
Epoch 3/20
30s - loss: 0.0700 - acc: 0.9802 - val_loss: 0.0694 - val_acc: 0.9805
Epoch 4/20
31s - loss: 0.0568 - acc: 0.9834 - val_loss: 0.0612 - val_acc: 0.9834
Epoch 5/20
31s - loss: 0.0492 - acc: 0.9852 - val_loss: 0.0612 - val_acc: 0.9829
Epoch 6/20
30s - loss: 0.0425 - acc: 0.9875 - val_loss: 0.0557 - val_acc: 0.9832
Epoch 7/20
30s - loss: 0.0379 - acc: 0.9888 - val_loss: 0.0565 - val_acc: 0.9829
Epoch 8/20
30s - loss: 0.0353 - acc: 0.9896 - val_loss: 0.0525 - val_acc: 0.9842
Epoch 9/20
30s - loss: 0.0315 - acc: 0.9904 - val_loss: 0.0502 - val_acc: 0.9845
Epoch 10/20
29s - loss: 0.0287 - acc: 0.9916 - val_loss: 0.0521 - val_acc: 0.9847
Epoch 11/20
29s - loss: 0.0255 - acc: 0.9921 - val_loss: 0.0544 - val_acc: 0.9837
Epoch 12/20
30s - loss: 0.0226 - acc: 0.9936 - val_loss: 0.0512 - val_acc: 0.9847
Epoch 13/20
34s - loss: 0.0209 - acc: 0.9938 - val_loss: 0.0522 - val_acc: 0.9843
Epoch 14/20
33s - loss: 0.0203 - acc: 0.9939 - val_loss: 0.0549 - val_acc: 0.9839
Epoch 15/20
32s - loss: 0.0176 - acc: 0.9949 - val_loss: 0.0593 - val_acc: 0.9841
Epoch 16/20
36s - loss: 0.0155 - acc: 0.9956 - val_loss: 0.0516 - val_acc: 0.9851
Epoch 17/20
32s - loss: 0.0133 - acc: 0.9962 - val_loss: 0.0541 - val_acc: 0.9848
Epoch 18/20
32s - loss: 0.0124 - acc: 0.9966 - val_loss: 0.0575 - val_acc: 0.9851
Epoch 19/20
39s - loss: 0.0115 - acc: 0.9969 - val_loss: 0.0625 - val_acc: 0.9833
Epoch 20/20
35s - loss: 0.0096 - acc: 0.9974 - val_loss: 0.0584 - val_acc: 0.9848
</code></pre>

<p><img src="http://parneetk.github.io/images/2017-01-22-CNN-MNIST_files/2017-01-22-CNN-MNIST_9_1.png" alt="png" /></p>

<pre><code>Model took 646.50 seconds to train
Accuracy on test data is: 98.63
</code></pre>

<h2 id="add-additional-fully-connected-layer">Add additional fully connected layer</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define the model</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Convolution2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">border_mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)))</span> 
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">))</span>
<span class="n">model2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;softmax&quot;</span><span class="p">))</span>
<span class="c"># Compile the model</span>
<span class="n">model2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="c"># Train the model</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">model2_info</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c"># plot model history</span>
<span class="n">plot_model_history</span><span class="p">(</span><span class="n">model2_info</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Model took </span><span class="si">%0.2f</span><span class="s"> seconds to train&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
<span class="c"># compute test accuracy</span>
<span class="k">print</span> <span class="s">&quot;Accuracy on test data is: </span><span class="si">%0.2f</span><span class="s">&quot;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">(</span><span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">model2</span><span class="p">)</span></code></pre></div>

<pre><code>Train on 48000 samples, validate on 12000 samples
Epoch 1/20
37s - loss: 0.2143 - acc: 0.9379 - val_loss: 0.0818 - val_acc: 0.9760
Epoch 2/20
38s - loss: 0.0642 - acc: 0.9805 - val_loss: 0.0590 - val_acc: 0.9821
Epoch 3/20
41s - loss: 0.0434 - acc: 0.9870 - val_loss: 0.0505 - val_acc: 0.9851
Epoch 4/20
43s - loss: 0.0315 - acc: 0.9902 - val_loss: 0.0496 - val_acc: 0.9857
Epoch 5/20
39s - loss: 0.0229 - acc: 0.9931 - val_loss: 0.0478 - val_acc: 0.9858
Epoch 6/20
40s - loss: 0.0178 - acc: 0.9946 - val_loss: 0.0475 - val_acc: 0.9873
Epoch 7/20
41s - loss: 0.0142 - acc: 0.9958 - val_loss: 0.0567 - val_acc: 0.9837
Epoch 8/20
39s - loss: 0.0102 - acc: 0.9970 - val_loss: 0.0467 - val_acc: 0.9876
Epoch 9/20
47s - loss: 0.0082 - acc: 0.9976 - val_loss: 0.0444 - val_acc: 0.9883
Epoch 10/20
40s - loss: 0.0061 - acc: 0.9982 - val_loss: 0.0513 - val_acc: 0.9876
Epoch 11/20
39s - loss: 0.0082 - acc: 0.9970 - val_loss: 0.0476 - val_acc: 0.9886
Epoch 12/20
37s - loss: 0.0066 - acc: 0.9976 - val_loss: 0.0545 - val_acc: 0.9867
Epoch 13/20
38s - loss: 0.0031 - acc: 0.9991 - val_loss: 0.0533 - val_acc: 0.9883
Epoch 14/20
38s - loss: 0.0024 - acc: 0.9994 - val_loss: 0.0507 - val_acc: 0.9897
Epoch 15/20
38s - loss: 0.0033 - acc: 0.9990 - val_loss: 0.0604 - val_acc: 0.9868
Epoch 16/20
41s - loss: 0.0046 - acc: 0.9987 - val_loss: 0.0544 - val_acc: 0.9882
Epoch 17/20
42s - loss: 0.0033 - acc: 0.9989 - val_loss: 0.0569 - val_acc: 0.9885
Epoch 18/20
38s - loss: 0.0054 - acc: 0.9981 - val_loss: 0.0626 - val_acc: 0.9874
Epoch 19/20
42s - loss: 0.0054 - acc: 0.9982 - val_loss: 0.0543 - val_acc: 0.9887
Epoch 20/20
43s - loss: 0.0018 - acc: 0.9995 - val_loss: 0.0560 - val_acc: 0.9892
</code></pre>

<p><img src="http://parneetk.github.io/images/2017-01-22-CNN-MNIST_files/2017-01-22-CNN-MNIST_11_1.png" alt="png" /></p>

<pre><code>Model took 814.36 seconds to train
Accuracy on test data is: 98.88
</code></pre>

<h2 id="increase-network-depth-by-adding-multiple-layers">Increase network depth by adding multiple layers</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define the model</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Convolution2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">border_mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Convolution2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="n">border_mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">))</span>
<span class="n">model3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;softmax&quot;</span><span class="p">))</span>
<span class="c"># Compile the model</span>
<span class="n">model3</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="c"># Train the model</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">model3_info</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c"># plot model history</span>
<span class="n">plot_model_history</span><span class="p">(</span><span class="n">model3_info</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Model took </span><span class="si">%0.2f</span><span class="s"> seconds to train&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
<span class="c"># compute test accuracy</span>
<span class="k">print</span> <span class="s">&quot;Accuracy on test data is: </span><span class="si">%0.2f</span><span class="s">&quot;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">(</span><span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">model3</span><span class="p">)</span></code></pre></div>

<pre><code>Train on 48000 samples, validate on 12000 samples
Epoch 1/20
121s - loss: 0.2081 - acc: 0.9406 - val_loss: 0.0630 - val_acc: 0.9815
Epoch 2/20
121s - loss: 0.0538 - acc: 0.9838 - val_loss: 0.0480 - val_acc: 0.9861
Epoch 3/20
126s - loss: 0.0347 - acc: 0.9890 - val_loss: 0.0531 - val_acc: 0.9838
Epoch 4/20
128s - loss: 0.0239 - acc: 0.9925 - val_loss: 0.0437 - val_acc: 0.9876
Epoch 5/20
125s - loss: 0.0170 - acc: 0.9947 - val_loss: 0.0442 - val_acc: 0.9876
Epoch 6/20
127s - loss: 0.0145 - acc: 0.9950 - val_loss: 0.0512 - val_acc: 0.9854
Epoch 7/20
142s - loss: 0.0107 - acc: 0.9963 - val_loss: 0.0444 - val_acc: 0.9882
Epoch 8/20
148s - loss: 0.0061 - acc: 0.9979 - val_loss: 0.0555 - val_acc: 0.9872
Epoch 9/20
136s - loss: 0.0075 - acc: 0.9976 - val_loss: 0.0498 - val_acc: 0.9882
Epoch 10/20
121s - loss: 0.0065 - acc: 0.9979 - val_loss: 0.0497 - val_acc: 0.9873
Epoch 11/20
117s - loss: 0.0059 - acc: 0.9981 - val_loss: 0.0530 - val_acc: 0.9878
Epoch 12/20
118s - loss: 0.0047 - acc: 0.9987 - val_loss: 0.0467 - val_acc: 0.9894
Epoch 13/20
121s - loss: 0.0023 - acc: 0.9992 - val_loss: 0.0580 - val_acc: 0.9884
Epoch 14/20
119s - loss: 0.0032 - acc: 0.9989 - val_loss: 0.0601 - val_acc: 0.9875
Epoch 15/20
121s - loss: 0.0054 - acc: 0.9982 - val_loss: 0.0525 - val_acc: 0.9897
Epoch 16/20
118s - loss: 0.0021 - acc: 0.9993 - val_loss: 0.0603 - val_acc: 0.9886
Epoch 17/20
117s - loss: 0.0060 - acc: 0.9981 - val_loss: 0.0554 - val_acc: 0.9880
Epoch 18/20
118s - loss: 0.0032 - acc: 0.9989 - val_loss: 0.0573 - val_acc: 0.9881
Epoch 19/20
120s - loss: 0.0024 - acc: 0.9991 - val_loss: 0.0615 - val_acc: 0.9888
Epoch 20/20
120s - loss: 0.0024 - acc: 0.9991 - val_loss: 0.0635 - val_acc: 0.9882
</code></pre>

<p><img src="http://parneetk.github.io/images/2017-01-22-CNN-MNIST_files/2017-01-22-CNN-MNIST_13_1.png" alt="png" /></p>

<pre><code>Model took 2496.97 seconds to train
Accuracy on test data is: 98.93
</code></pre>

<h2 id="add-droput-layer-and-batch-normalization">Add Droput Layer and Batch Normalization</h2>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define the model</span>
<span class="n">model4</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Convolution2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">border_mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">BatchNormalization</span><span class="p">())</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Convolution2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="n">border_mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">BatchNormalization</span><span class="p">())</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;relu&quot;</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">))</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">BatchNormalization</span><span class="p">())</span>
<span class="n">model4</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s">&quot;softmax&quot;</span><span class="p">))</span>
<span class="c"># Compile the model</span>
<span class="n">model4</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="c"># Train the model</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">model4_info</span> <span class="o">=</span> <span class="n">model4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c"># plot model history</span>
<span class="n">plot_model_history</span><span class="p">(</span><span class="n">model4_info</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Model took </span><span class="si">%0.2f</span><span class="s"> seconds to train&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
<span class="c"># compute test accuracy</span>
<span class="k">print</span> <span class="s">&quot;Accuracy on test data is: </span><span class="si">%0.2f</span><span class="s">&quot;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">(</span><span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">model4</span><span class="p">)</span></code></pre></div>

<pre><code>Train on 48000 samples, validate on 12000 samples
Epoch 1/20
307s - loss: 0.5792 - acc: 0.9217 - val_loss: 0.7829 - val_acc: 0.9788
Epoch 2/20
304s - loss: 0.2892 - acc: 0.9717 - val_loss: 0.1357 - val_acc: 0.9865
Epoch 3/20
306s - loss: 0.2037 - acc: 0.9793 - val_loss: 0.1154 - val_acc: 0.9872
Epoch 4/20
306s - loss: 0.1532 - acc: 0.9823 - val_loss: 0.0779 - val_acc: 0.9882
Epoch 5/20
305s - loss: 0.1257 - acc: 0.9846 - val_loss: 0.0664 - val_acc: 0.9892
Epoch 6/20
306s - loss: 0.1023 - acc: 0.9863 - val_loss: 0.0577 - val_acc: 0.9889
Epoch 7/20
306s - loss: 0.0884 - acc: 0.9873 - val_loss: 0.0468 - val_acc: 0.9902
Epoch 8/20
303s - loss: 0.0769 - acc: 0.9886 - val_loss: 0.0410 - val_acc: 0.9904
Epoch 9/20
303s - loss: 0.0656 - acc: 0.9902 - val_loss: 0.0439 - val_acc: 0.9892
Epoch 10/20
302s - loss: 0.0598 - acc: 0.9899 - val_loss: 0.0376 - val_acc: 0.9920
Epoch 11/20
303s - loss: 0.0533 - acc: 0.9912 - val_loss: 0.0337 - val_acc: 0.9924
Epoch 12/20
303s - loss: 0.0453 - acc: 0.9926 - val_loss: 0.0334 - val_acc: 0.9909
Epoch 13/20
303s - loss: 0.0433 - acc: 0.9920 - val_loss: 0.0304 - val_acc: 0.9920
Epoch 14/20
300s - loss: 0.0414 - acc: 0.9925 - val_loss: 0.0302 - val_acc: 0.9920
Epoch 15/20
314s - loss: 0.0364 - acc: 0.9931 - val_loss: 0.0323 - val_acc: 0.9911
Epoch 16/20
313s - loss: 0.0331 - acc: 0.9939 - val_loss: 0.0338 - val_acc: 0.9911
Epoch 17/20
314s - loss: 0.0317 - acc: 0.9937 - val_loss: 0.0294 - val_acc: 0.9918
Epoch 18/20
312s - loss: 0.0292 - acc: 0.9945 - val_loss: 0.0288 - val_acc: 0.9925
Epoch 19/20
314s - loss: 0.0256 - acc: 0.9948 - val_loss: 0.0286 - val_acc: 0.9922
Epoch 20/20
313s - loss: 0.0252 - acc: 0.9948 - val_loss: 0.0293 - val_acc: 0.9922
</code></pre>

<p><img src="http://parneetk.github.io/images/2017-01-22-CNN-MNIST_files/2017-01-22-CNN-MNIST_15_1.png" alt="png" /></p>

<pre><code>Model took 6158.77 seconds to train
Accuracy on test data is: 99.20
</code></pre>


        <hr />
        
        

        <footer class="page-footer">
          <div class="author-image">
	<img src="/images/bio-photo.png" alt="Parneet Kaur">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <span itemprop="author">Parneet Kaur</span></h3>
	<p class="author-bio">PhD candidate at Rutgers University.</p>
  <p class="author-follow"><a href="https://twitter.com/_parneetkaur" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @_parneetkaur</a></p>
</div><!-- ./author-content -->
          <div class="page-meta">
	
    <span><i class="fa fa-folder-open-o fa-fw"></i> &nbsp; <a href="http://parneetk.github.io/tag/keras/" title="keras" rel="tag">keras</a>, <a href="http://parneetk.github.io/tag/deep-learning/" title="deep_learning" rel="tag">deep_learning</a>, <a href="http://parneetk.github.io/tag/python-for-cv/" title="python_for_cv" rel="tag">python_for_cv</a></span>
  
	
    <span><i class="fa fa-clock-o fa-fw"></i> &nbsp; Updated <time datetime="2017-01-22T17:01:33Z" itemprop="datePublished">January 22, 2017</time></span>
  
</div><!-- /.page-meta -->
        </footer><!-- /.footer -->
      </div><!-- /.content -->
    </div><!-- /.inner-wrap -->
    <div class="sidebar">
		<h3>Recent Posts</h3>
		<ul>
			
				<li><a href="/blog/cnn-mnist/">Convolutional Neural Networks (CNN) for MNIST Dataset</a></dd>
			
				<li><a href="/blog/neural-networks-in-keras/">Neural Networks in Keras</a></dd>
			
				<li><a href="/blog/intro-to-matplotlib/">Intro to Matplotlib</a></dd>
			
				<li><a href="/blog/intro-to-numpy/">Intro to NumPy</a></dd>
			
				<li><a href="/blog/python_quickstart/">Python Quickstart </a></dd>
			
				<li><a href="/blog/projectcsgirls-mentor/">My experience as a projectCSGirls mentor</a></dd>
			
		</ul>
		<h3>All Tags</h3>
		<ul>
		
			<a href="/tag/projects/">
				projects
			</a>
		
			<a href="/tag/research/">
				research
			</a>
		
			<a href="/tag/women_in_tech/">
				women_in_tech
			</a>
		
			<a href="/tag/python_for_cv/">
				python_for_cv
			</a>
		
			<a href="/tag/keras/">
				keras
			</a>
		
			<a href="/tag/deep_learning/">
				deep_learning
			</a>
		
		</ul>
    </div><!-- /.sidebar -->
  </article><!-- /.wrap -->
  
  <div class="wrap">
    <div class="related-posts">
  <h3>Read This Next</h3>
  <div class="tiles">
  
    <article class="tile" itemscope itemtype="http://schema.org/Article">
	<h2 class="post-title" itemprop="name"><a href="http://parneetk.github.io/blog/neural-networks-in-keras/">Neural Networks in Keras</a></h2>
  <p class="entry-date date published"><time datetime="2017-01-21" itemprop="datePublished">January 21, 2017</time></p>
	<p class="post-excerpt" itemprop="description">Examples to use Neural Networks</p>
</article><!-- /.tile -->
  
    <article class="tile" itemscope itemtype="http://schema.org/Article">
	<h2 class="post-title" itemprop="name"><a href="http://parneetk.github.io/blog/intro-to-matplotlib/">Intro to Matplotlib</a></h2>
  <p class="entry-date date published"><time datetime="2017-01-07" itemprop="datePublished">January 07, 2017</time></p>
	<p class="post-excerpt" itemprop="description">Plotting library for Python</p>
</article><!-- /.tile -->
  
    <article class="tile" itemscope itemtype="http://schema.org/Article">
	<h2 class="post-title" itemprop="name"><a href="http://parneetk.github.io/blog/intro-to-numpy/">Intro to NumPy</a></h2>
  <p class="entry-date date published"><time datetime="2017-01-06" itemprop="datePublished">January 06, 2017</time></p>
	<p class="post-excerpt" itemprop="description">Learn about array and matrix manipulation in Python</p>
</article><!-- /.tile -->
  
    <article class="tile" itemscope itemtype="http://schema.org/Article">
	<h2 class="post-title" itemprop="name"><a href="http://parneetk.github.io/blog/python_quickstart/">Python Quickstart </a></h2>
  <p class="entry-date date published"><time datetime="2017-01-05" itemprop="datePublished">January 05, 2017</time></p>
	<p class="post-excerpt" itemprop="description">Introduction to Python Basics</p>
</article><!-- /.tile -->
  
  </div>
</div>
  </div><!-- /.wrap -->
  
  
  <div class="wrap">
    <aside class="inner-wrap"><div class="comments">
	<h3>Leave a Comment</h3>
	<div id="disqus_thread"></div>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div><!-- /.comments --></aside>
    
  </div><!-- /.wrap -->
  
</div><!-- /#main -->


      <footer role="contentinfo" id="site-footer">
	<p class="copyright">&#169; 2017 Parneet Kaur</p>
</footer>
    </div>

    <script src="/assets/main-df82fc05892ed74ebcc5daea31e5af0e.js"></script>

    <!-- Google Universal Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57868514-1', 'parneetk.github.io');
      ga('require', 'linkid', 'linkid.js');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>

    
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'parneetk';
      var disqus_title = 'Convolutional Neural Networks (CNN) for MNIST Dataset';
      var disqus_url = 'http://parneetk.github.io/blog/cnn-mnist/';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());

      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    

  </body>

</html>
